import{_ as N,r,c as F,o as L,a as v,b as t,w as z,u as p,d as b,e as M,t as y,v as P,F as R,f as q,g as w}from"./index-BnMMo38Y.js";import{u as A}from"./endpoint-CQQaYNe8.js";const G={class:"load-page"},H={class:"back"},J={class:"loading-logo"},K={class:"outer"},O=["src"],Q={class:"outer"},U=["src"],W={class:"outer"},X=["src"],Y={class:"loading-cont"},Z={key:0,class:"loader"},ee={key:1,class:"reload"},se={class:"err"},te={__name:"LoadingView",setup(ae){const l=A(),d=r(null),n=r(null),i=r(null),m=r(0),f=r(0),u=r("");function k(s){s==1?m.value+=1:f.value+=1}const _=F(()=>m.value==3&&f.value==7?u.value:""),g=q();async function D(s){u.value="",n.value=null,i.value=null;try{const e=await fetch(s);e.ok?i.value=await e.json():(n.value=`${e.status}: قم بإعادة تحديث الصفحة`,u.value+=`res.ok = ${e.ok} |||||`,u.value+=`res.status = ${e.status} |||||`,u.value+=`res.statusText = ${e.statusText} |||||`,u.value+=`await res.json() = ${await e.json()} |||||`)}catch(e){n.value="تحقق من إتصالك بالإنترنت أو قد يكون هنالك خطأ في السيرفر",u.value+=`err = ${e}`}}function C(s,e,a){s[0]!=null||s[1]===!0&&(e.value=a)}function E(s,e,a){s[0]!=null||s[1]===!0&&l.setSessionToken(a)}function x(){E(arguments,l.sessionToken,i.value.sessionToken)}function I(){C(arguments,d,Date.now())}function $(s,e){s[0]!=null||(s[1]!=null?e.value=s[1]:s[2])}function V(){$(arguments,l.sessionToken)}function S(){$(arguments,d)}async function h(s,e,a,o){var c=e.replace(/&/g,"%26");c=c.replace(/=/g,"%3D"),await D(l.base_url+`/api?it=${c}&pr=${a}&vr=${o}`),i.value.done===!1?n.value=`${i.value.error}`:(window.specialData.ss.setItem("token",i.value.sessionToken,x),window.specialData.ss.setItem("tokenExpireDate",Date.now(),I),s())}async function T(){try{window.specialData.ss.getItem("token",V),window.specialData.ss.getItem("tokenExpireDate",S)}catch(o){o.value=`Error: ${o}`}const s=window.specialData.inD,e=window.specialData.v,a=window.specialData.pl;if(l.sessionToken===null||d+6051e5>Date.now())h(()=>{g.replace("/home")},s,a,e);else if(l.sessionToken!=null&&d+6051e5<=Date.now()){const o=window.specialData.d.u.username,c=window.specialData.d.u.id,j=window.specialData.d.u.is_premium,B=window.specialData.d.u.photo_url;await D(l.base_url+`/visit?on=${l.sessionToken}&mu=${o}&du=${c}&pr=${a}&vr=${e}&isp=${j}&prl=${B}`),i.value.done===!1&&h(()=>{},s,a,e),g.replace("/home")}else n.value="أعد المحاولة، فإذا تكرر هذا الخطأ كثيرا، يرجى إبلاغ المكتبة بذلك! لحل الخطأ."}return L(()=>{T()}),(s,e)=>(w(),v(R,null,[t("div",{class:"ttaapp1",onClick:e[0]||(e[0]=a=>k(1))}),t("div",G,[t("div",H,[t("div",J,[t("div",K,[t("img",{alt:"مكتبة أبو سعيدة الوثائقية العامة",class:"logo",src:p(l).static_url+"/src/assets/imgs/logo3.png",width:"90",height:"90"},null,8,O),e[2]||(e[2]=t("div",null,null,-1))]),t("header",null,[t("div",Q,[t("img",{alt:"مركز الفهرسة والتوثيق",class:"main-titles",src:p(l).static_url+"/src/assets/imgs/subtitle.png",width:"230"},null,8,U),e[3]||(e[3]=t("div",null,null,-1))]),t("div",W,[t("img",{alt:"المكتبة الوثائقية االعامة",class:"main-titles",src:p(l).static_url+"/src/assets/imgs/title.png",width:"130"},null,8,X),e[4]||(e[4]=t("div",null,null,-1))])])]),t("div",Y,[n.value?b("",!0):(w(),v("div",Z)),n.value?(w(),v("div",ee,[t("div",se,[e[5]||(e[5]=t("div",null,"حصل خطأ ما !",-1)),M(" "+y(n.value),1)]),t("button",{class:"btn",onClick:T},"تحديث")])):b("",!0)])])]),z(t("div",{class:"specialError"},y(_.value),513),[[P,_.value.length>0]]),t("div",{class:"ttaapp2",onClick:e[1]||(e[1]=a=>k(2))})],64))}},oe=N(te,[["__scopeId","data-v-a0837ba5"]]);export{oe as default};
